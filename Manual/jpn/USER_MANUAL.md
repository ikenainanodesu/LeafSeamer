# LeafSeamer ユーザーマニュアル

このマニュアルでは、LeafSeamerの各機能モジュールの使用方法について詳しく説明します。

## 目次

1. [Dashboard 概要](#dashboard-概要)
2. [Seamer - シーンコントロールカードシステム](#seamer---シーンコントロールカードシステム)
3. [Mixer Control - ミキサーコントロール](#mixer-control---ミキサーコントロール)
4. [OBS Control - OBS コントロール](#obs-control---obs-コントロール)
5. [VB Matrix Control - VB-Audio Matrix コントロール](#vb-matrix-control---vb-audio-matrix-コントロール)
6. [Graphics Package - グラフィックスパッケージ](#graphics-package---グラフィックスパッケージ)
7. [Schedule Manager - スケジュール管理](#schedule-manager---スケジュール管理)
8. [Logger System - ログシステム](#logger-system---ログシステム)
9. [Backup System - バックアップシステム](#backup-system---バックアップシステム)

---

## Dashboard 概要

LeafSeamerを起動後、`http://localhost:9090` にアクセスしてDashboardを開きます。

### ワークスペース（Workspaces）

Dashboardは機能ごとに複数のワークスペースに整理されており、上部のタブをクリックして切り替えることができます：

- **Seamer**：シーンコントロールカードシステム
- **Mixer Control**：ミキサー接続とコントロール
- **OBS Control**：OBS接続とコントロール
- **VB Control**：VB-Audio Matrix設定とコントロール
- **Graphic Control**：グラフィックスパッケージコントロール
- **Misc**：バックアップ、ログなどの補助機能

### パネルレイアウト

各ワークスペースには複数のパネル（Panel）が含まれており、パネルはDashboard内で自由にドラッグして配置できます。

---

## Seamer - シーンコントロールカードシステム

SeamerはLeafSeamerの中核機能であり、視覚的なカード式シーンコントロールを提供します。

### 機能概要

- **カード管理**：コントロールカードの作成、編集、削除
- **マルチアクション連携**：1つのカードに複数のコントロールアクションを含めることが可能
- **プリセットシステム**：カードレイアウトのプリセット保存と読み込み
- **ドラッグ＆ドロップ並べ替え**：直感的なドラッグ操作でカードの順序を調整

### カードの作成

1. **Seamer** ワークスペースで、**"+ Add Card"** ボタンをクリックします
2. ポップアップ表示される編集ウィンドウで設定します：
   - **カード名**：カードに名前を付けます（例：「オープニングシーン」）
   - **カード色**：識別しやすいようにカードの背景色を選択します
3. **"Add Action"** をクリックしてアクションを追加します

### アクションの設定

各カードには複数のアクションを含めることができ、順に実行されます：

#### Mixer Control（ミキサーコントロール）

- **Fader**：チャンネルフェーダー制御
  - 入力チャンネルを選択
  - 目標レベル（dB）を設定
- **Sends**：センド構成
  - 入力および出力チャンネルを選択
  - ゲイン、On/Off、Pre/Post、パンを設定

#### OBS Control（OBS コントロール）

- OBSインスタンスを選択
- ターゲットシーンを選択
- トランジション効果を選択（オプション）

<details><summary>遅延機能は近日公開予定</summary>

~~Delay（遅延）
遅延時間（ミリ秒）を設定
アクション間のタイミング制御に使用~~

</details>

### カードの実行

- **単一実行**：カードをクリックするだけで、その中のすべてのアクションがトリガーされます
- **アクション順序**：アクションは追加された順序で実行されます
- ~~**遅延制御**：Delayアクションを使用して実行タイミングを制御~~

### プリセット管理

#### プリセットの保存

1. すべてのカードを配置した後、**"Save Preset"** をクリックします
2. プリセット名を入力します
3. プリセットには、現在のすべてのカードの構成と配置が保存されます

#### プリセットの読み込み

1. **"Load Preset"** をクリックします
2. リストから読み込むプリセットを選択します
3. 現在のカードレイアウトがプリセットの内容に置き換わります

#### プリセットの削除

1. プリセットリストから削除するプリセットを見つけます
2. 削除ボタンをクリックして削除を確認します

### ベストプラクティス

- **シナリオ管理**：番組のセグメントごとに専用のプリセットを作成します（例：「オープニング」、「インタビュー」、「エンディング」）
- **色分け**：カードの種類を区別するために異なる色を使用します（例：赤=緊急、緑=通常）
- **命名規則**：素早く識別できる明確な名前を使用します

---

## Mixer Control - ミキサーコントロール

Yamaha RCPプロトコルを介してミキサーデバイスを制御します。

### ミキサーの接続

- 現在、DM3のみをサポートしています
- 現在、DM3上でのみ機能テストが完了しています
- 理論的にはDM7も使用可能ですが、テストが必要です

1. **Mixer Control** ワークスペースで、**"Mixer Connection"** パネルを見つけます
2. 接続パラメータを設定します：
   - **IP Address**：ミキサーのIPアドレス
   - **Port**：RCPポート（デフォルト 49280）
3. **"Connect"** をクリックして接続を確立します
4. 接続に成功すると、ステータスインジケーターが緑色になります

### フェーダーコントロール（Fader）

**"Mixer Control"** パネルで：

1. 入力チャンネルを選択します
2. フェーダースライダーをドラッグするか、数値を入力します
3. レベルの変化はリアルタイムでミキサーに送信されます

### 入力センド（Input Send）

入力チャンネルから出力チャンネルへのセンドを構成します：

1. **入力チャンネル**（Input）を選択します
2. **出力チャンネル**（Output）を選択します
3. パラメータを構成します：
   - **Gain**：センドゲイン（dB）
   - **On/Off**：センドの有効化または無効化
   - **Pre/Post**：センドポイントの選択
     - Pre：プリフェーダーセンド
     - Post：ポストフェーダーセンド
   - **Pan**：パン（L/R）

<details><summary>現在RCP関連ドキュメントが不足しているため、パッチ機能は未完成です</summary>

```
### パッチ構成

入出力ルーティングを構成します：

1. Patch Controlエリアで：
   - **入力デバイス**（Input Device）を選択
   - **出力デバイス**（Output Device）を選択
2. 複数のPatchパネルの追加をサポート
3. **"+"** をクリックして新しいPatchパネルを追加
4. **"×"** をクリックしてPatchパネルを削除（最初のパネルは削除不可）
```

</details>

### トラブルシューティング

- **接続失敗**：
  - IPアドレスとポートが正しいか確認してください
  - ネットワーク接続とファイアウォール設定を確認してください

- **制御不能**：
  - 接続ステータスが「接続済み」であることを確認してください
  - ログシステムのエラーメッセージを確認してください
  - 一部のコマンドはミキサーでサポートされていない可能性があります（パッチなど）

---

## OBS Control - OBS コントロール

WebSocketプロトコルを介してOBS Studioを制御し、マルチインスタンス管理をサポートします。

### OBSの接続

#### OBS WebSocketの有効化

1. OBS Studioを開きます
2. **ツール → WebSocket サーバー設定** に移動します
3. WebSocketサーバーを有効にします
4. ポート（デフォルト 4455）とパスワードを設定します
5. OKをクリックします

#### LeafSeamerでの接続

1. **OBS Control** ワークスペースで、**"OBS Connection"** パネルを見つけます
2. **"+ Add Connection"** をクリックしてOBSインスタンスを追加します
3. 接続パラメータを設定します：
   - **Instance Name**：インスタンス識別子（例：「Main OBS」）
   - **IP Address**：OBSを実行しているデバイスのIP（ローカルの場合は `127.0.0.1`）
   - **Port**：WebSocketポート（デフォルト 4455）
   - **Password**：WebSocketパスワード
4. **"Connect"** をクリックして接続します

#### 接続ステータス

- **Connecting...**：接続を試行中
- **Connected**：接続成功
- **Disconnected**：未接続
- **Connection failed**：接続失敗（自動的に3回再試行します）

### シーンコントロール

**"OBS Control"** パネルで：

1. OBSインスタンスを選択します（複数の場合）
2. シーンリストからターゲットシーンを選択します
3. シーン名をクリックしてそのシーンに切り替えます

### トランジション効果

1. シーンリストでトランジションタイプを選択します
2. シーン切り替え時に、選択したトランジション効果が適用されます

### リアルタイムステータス

接続成功後に表示されます：

- 現在のシーン名
- 録画ステータス
- 配信ステータス
- 配信統計情報（ビットレート、FPSなど）

### マルチOBSインスタンス管理

1. 複数のOBSインスタンス（メイン、バックアップなど）を追加可能
2. 各インスタンスは個別に管理および制御されます
3. Seamerカードで制御するインスタンスを選択可能

### 自動再接続

- 切断後、自動的に再接続を試みます（最大3回）
- 再接続間隔 2秒
- 失敗後にエラーメッセージを表示します

---

## VB Matrix Control - VB-Audio Matrix コントロール

VBANプロトコルを介してVB-Audio Matrixオーディオルーターマトリックスを制御します。

### ネットワーク構成

**"VB Network Config"** パネルで：

1. **IP**：VB-Audio MatrixのIPアドレスを入力
2. **Port**：VBANポートを入力（デフォルト 6980）
3. **Stream**: VB-Audio MatrixのStream名を入力
   - ここではMatrix VBAN内のStream名と厳密に一致させる必要があります
4. **Local IP**：ローカルIPアドレスを表示（自動検出）
5. **"Ping Test"** をクリックしてネットワーク接続をテストします：
   - **OK!!**（緑）：ネットワーク接続良好
   - **Fail**（赤）：ネットワーク接続不可

- VBAN接続には以下の厳密な一致が必要です
  - IPアドレス
  - ポート
  - Stream 名

### パッチコントロール

**"VB Matrix Control"** パネルで：

1. **Input Device**：入力デバイスを選択
2. **Output Device**：出力デバイスを選択
3. 選択するとルーティング構成が自動的に適用されます

#### マルチパッチパネル

- **"+"** ボタンをクリックして新しいPatchコントロールパネルを追加します
- パネル右上の **"×"** ボタンをクリックして削除します（最初のパネルは削除不可）
- 複数の入出力ルートを同時に構成可能

### プリセット管理

- **Save Preset**：すべてのパッチパネルの現在の構成を保存
- **Load Preset**：保存されたプリセットを読み込み
- **Delete Preset**：プリセットを削除

プリセットに保存される内容：

- すべてのパッチパネルの数と構成
- 各パネルの入出力デバイスの選択

### 注意事項

- VB-Audio Matrixソフトウェアが実行されていることを確認してください
- VBAN機能が有効になっていることを確認してください
- Ping Testを使用してネットワーク接続を確認してください

---

## Graphics Package - グラフィックスパッケージ

Lower Third、Scoreboardなどのグラフィックスオーバーレイ機能を提供します。

### グラフィックスページへのアクセス

グラフィックスページは、OBSやその他のビデオソフトウェアでブラウザソースとして追加する必要があります：

```
http://localhost:9090/bundles/graphics-package/graphics/lower-third.html
http://localhost:9090/bundles/graphics-package/graphics/scoreboard.html
```

### Lower Third（字幕バー）

1. Dashboardで構成：
   - **Name**：人物名
   - **Title**：役職/肩書き
2. **"Show"** をクリックして字幕バーを表示
3. **"Hide"** をクリックして字幕バーを非表示
4. GSAPアニメーションを使用してスムーズな入場および退場効果を実現

### Scoreboard（スコアボード）

1. 試合情報を構成：
   - チーム名
   - スコア
2. **"Update"** をクリックして表示を更新
3. カスタムスタイルとアニメーションをサポート

---

<details><summary>機能制作中</summary>

## Schedule Manager - スケジュール管理

番組のタイムテーブルとスケジュール表示を管理します。

### スケジュールの作成

1. **Schedule Manager** ワークスペースでコントロールパネルを開きます
2. スケジュール項目を追加：
   - **時間**：番組開始時間
   - **タイトル**：番組名
   - **説明**：番組紹介
3. **"Save"** をクリックしてスケジュールを保存

### スケジュール表示

スケジュール表示グラフィックスをOBSに追加：

```
http://localhost:9090/bundles/schedule-manager/graphics/schedule-display.html
```

### データ同期

Google Sheetsからのスケジュールデータの同期をサポート（Google API構成が必要）。

---

</details>

## Logger System - ログシステム

すべてのシステムログを一元的に表示します。

### ログの表示

**Misc** ワークスペースで **"Log Viewer"** パネルを見つけます：

1. 最新のログをリアルタイムで表示
2. ログは時間の降順で並べ替えられます
3. ログレベルごとに異なる色で識別されます：
   - **Info**：一般情報（青）
   - **Warning**：警告（黄）
   - **Error**：エラー（赤）

### ログファイル

ログファイルは `logs/` ディレクトリに保存されます：

- 日付ごとにファイル分けして保存
- ログローテーションをサポート
- 過去のログファイルを手動で確認可能

---

## Backup System - バックアップシステム

プロジェクトの構成とデータを自動または手動でバックアップします。

### バックアップの作成

**Misc** ワークスペースで **"Backup Control"** パネルを見つけます：

1. **"Create Backup"** をクリックしてバックアップを作成します
2. バックアップファイルは `backups/` ディレクトリに保存されます
3. バックアップファイル名の形式：`backup-YYYY-MM-DD-HH-mm-ss.zip`

### バックアップ内容

バックアップには以下が含まれます：

- `db/` ディレクトリ（Replicantsデータ）
- `cfg/` ディレクトリ（構成ファイル）
- プリセットデータ
- その他のユーザーデータ

### バックアップの復元

1. バックアップファイルを解凍します
2. バックアップ内容を対応するディレクトリにコピーします
3. NodeCGを再起動します

### ベストプラクティス

- 重要な操作の前に手動でバックアップを作成する
- 定期的なバックアップ（週に1回以上を推奨）
- バックアップファイルを別の場所（クラウドストレージ、外付けハードドライブなど）に保存する

---

<details><summary>キーボードショートカット (将来のバージョンでサポート予定)</summary>

## キーボードショートカット

現在、LeafSeamer 1.0.0は主にマウスクリックで操作されますが、将来のバージョンでキーボードショートカットのサポートが追加される予定です。

---

</details>

## ヒントと提案

### シーンカードの設計

- 頻繁に使用するシーンを上部に配置する
- カードの種類を区別するために色を使用する
- カードには明確な名前を付ける

### プリセット管理

- 番組の種類ごとに専用のプリセットを作成する
- 不要なプリセットを定期的に整理する
- プリセット名は意味のあるものにする（例：「ニュース番組 - 標準構成」）

### デバイス接続

- 安定したネットワーク環境で使用する
- Wi-Fiの代わりに有線ネットワークを使用する
- デバイスの接続状態を定期的に確認する

---

## 次のステップ

- 詳細な技術情報については [README.md](./README.md) をご覧ください
- インストール構成については [INSTALLATION.md](./INSTALLATION.md) をご覧ください

## フィードバックとサポート

問題や提案がある場合は、ログシステムを確認するか、`logs/` ディレクトリ内のログファイルをチェックしてください。
