import{r as x,j as e,R as g,c as b}from"../shared/client-tdAoRyTx.js";const y=()=>{const[s,n]=x.useState([]),[a,i]=x.useState([]);x.useEffect(()=>{nodecg.Replicant("networkConfigs",{defaultValue:[]}).on("change",t=>{t&&n(t)}),nodecg.Replicant("hostInfo").on("change",t=>{t&&t.ips&&i(t.ips)})},[]);const d=()=>{const o={id:Math.random().toString(36).substr(2,9),name:`Matrix ${s.length+1}`,ip:"127.0.0.1",port:6980,streamName:"Command1"},r=[...s,o];n(r),nodecg.Replicant("networkConfigs").value=r},p=(o,r)=>{const t=s.map(c=>c.id===o?{...c,...r}:c);n(t),nodecg.Replicant("networkConfigs").value=t},l=o=>{if(!confirm("Are you sure you want to remove this connection?"))return;const r=s.filter(t=>t.id!==o);n(r),nodecg.Replicant("networkConfigs").value=r};return e.jsxs("div",{style:{padding:"10px",display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{children:"Network Configuration"}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#888"},children:["Local IPs: ",a.join(", ")]})]}),s.map(o=>e.jsx(C,{config:o,onUpdate:r=>p(o.id,r),onRemove:()=>l(o.id)},o.id)),e.jsx("button",{onClick:d,style:{padding:"10px",border:"2px dashed #ccc",backgroundColor:"transparent",cursor:"pointer",borderRadius:"4px",color:"#888"},children:"+ Add Network Configuration"})]})},C=({config:s,onUpdate:n,onRemove:a})=>e.jsxs("div",{style:{border:"1px solid #ccc",padding:"10px",borderRadius:"4px",position:"relative"},children:[e.jsx("button",{onClick:a,style:{position:"absolute",top:"5px",right:"5px",background:"none",border:"none",color:"red",cursor:"pointer",fontWeight:"bold"},children:"X"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsx("div",{style:{marginBottom:"5px"},children:e.jsx("input",{value:s.name,onChange:i=>n({name:i.target.value}),style:{fontWeight:"bold",border:"none",borderBottom:"1px solid #ccc",width:"100%"},placeholder:"Connection Name"})}),e.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("label",{children:["IP:",e.jsx("input",{type:"text",value:s.ip,onChange:i=>n({ip:i.target.value}),style:{marginLeft:"5px",width:"110px"}})]}),e.jsxs("label",{children:["Port:",e.jsx("input",{type:"number",value:s.port,onChange:i=>n({port:parseInt(i.target.value)||0}),style:{marginLeft:"5px",width:"60px"}})]}),e.jsxs("label",{children:["Stream:",e.jsx("input",{type:"text",value:s.streamName,onChange:i=>n({streamName:i.target.value}),style:{marginLeft:"5px",width:"80px"}})]}),e.jsx(j,{configId:s.id})]})]})]}),j=({configId:s})=>{const[n,a]=g.useState("idle"),[i,d]=g.useState(!1),p=async()=>{if(!i){d(!0);for(let o=0;o<5;o++){let r=!1;try{const t=new Promise((c,f)=>{const h=setTimeout(()=>{nodecg.unlisten("pingSuccess",u),f(new Error("Timeout"))},500),u=m=>{m&&m.connectionId===s&&(clearTimeout(h),nodecg.unlisten("pingSuccess",u),c())};nodecg.listenFor("pingSuccess",u)});nodecg.sendMessage("ping",s),await t,r=!0,a("success")}catch{a("error")}await new Promise(t=>setTimeout(t,200)),a("idle"),o<4&&await new Promise(t=>setTimeout(t,800))}d(!1)}};let l="#eee";return n==="success"&&(l="#52c41a"),n==="error"&&(l="#ff4d4f"),e.jsx("button",{onClick:p,disabled:i,style:{backgroundColor:l,color:n==="idle"?"black":"white",border:"1px solid #ccc",borderRadius:"4px",padding:"2px 8px",cursor:i?"default":"pointer",minWidth:"60px"},children:i?n==="success"?"OK":n==="error"?"Fail":"...":"Ping"})},w=b.createRoot(document.getElementById("root"));w.render(e.jsx(g.StrictMode,{children:e.jsx(y,{})}));
